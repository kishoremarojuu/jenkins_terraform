
# Prerequisite
1. You need atleast 2 aws accounts to setup Jenkins Master/Slave cluster
2. Install Terraform version 1.0 or above in your local machine
3. Install Docker CLI in your local machine
4. Install AWS CLI in your local machine
5. Configure 2 AWS profiles in your local machine, with proper names. (For eg : jenkins-controller & jenkins-agent1)
6. Create Terraform state S3 bucket (private bucket) via aws console

# Preration
1. Update following configs in "environment/agent_poc/terraform.tf" and "environment/poc/terraform.tf" files
   a. profile (refer step 5 in Prerequisite section)
   b. bucket  (refer step 6 in Prerequisite section)

# Deploy Jenkins Agent Cluster
1. Update "jenkins_controller_account_id" in "environment/agent_poc/jenkins-agents.tf"
2. Go to directory "environment/agent_poc" and run
   a. terraform init
   b. terraform apply
3. Once deployed successfully, run "terraform output" and note down the values of
   a. jenkins_agent_private_subnets
   b. jenkins_agent_sg_id

# Deploy Jenkins Controller Cluster
1. Update Following configs in "environment/poc/jenkins-controller.tf"
   a. remote_agent_account_id
   b. remote_agent_subnets          (refer step 3 in "Deploy Jenkins Agent Cluster" section)
   c. remote_agent_security_groups  (refer step 3 in "Deploy Jenkins Agent Cluster" section)
2. Rename "jenkins-controller.tf" file to "jenkins-controller.tf.disabled"
3. Go to "terraform/environment/poc" directory and run "terraform init" command.
4. And run "terraform plan" and verify evrything is fine.
5. Once plan is good, run "terraform apply" wait for it to complete.
6. Rename file "jenkins-controller.tf.disabled" to "jenkins-controller.tf"
7. Update values from step #8 in "jenkins-controller.tf" file
8. Go to "terraform/environment/poc" directory and run "terraform init" command.
9. And run "terraform plan" and verify evrything is fine.
10. Once plan is good, run "terraform apply" wait for it to complete.

VERFICATION
1. Go to AWS console, and open Systems Manager > Parameter Store > open "jenkins-pwd" and note down the value. This is your jenkins UI password.
2. Go to AWS console, and open EC2 > LoadBalancers > Note the "DNS Name of "serverless-jenkins-crtl-alb" LB. This is the URL of your jenkins.
3. Try to access the Jenkins URL in your browser and login with user "ecsuser" and use the above password (step #1).
